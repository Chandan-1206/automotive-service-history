<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Vehicle Records</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f9f9f9;
        }
        table {
            width: 90%;
            margin: 20px auto;
            border-collapse: collapse;
            background: #fff;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        th, td {
            padding: 12px;
            border-bottom: 1px solid #eee;
            text-align: center;
        }
        th {
            background: #007bff;
            color: white;
            font-weight: 600;
        }
        h2 {
            text-align:center;
            margin-top: 20px;
            color: #333;
        }
        /* Button base */
        button, a.delete {
            padding: 6px 12px;
            margin: 2px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease-in-out;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            text-decoration: none;
            color: white;
        }
        /* Different button styles */
        .editBtn { background: #007BFF; }
        .editBtn:hover { background: #0056b3; }

        .delete { background: #dc3545; }
        .delete:hover { background: #a71d2a; }

        .save { background: #28a745; }
        .save:hover { background: #1e7e34; }

        .cancel { background: #6c757d; }
        .cancel:hover { background: #565e64; }

        .addRowBtn { background: #17a2b8; }
        .addRowBtn:hover { background: #117a8b; }

        /* Emoji-like icons in buttons */
        .editBtn::before { content: "‚úèÔ∏è"; }
        .delete::before { content: "üóëÔ∏è"; }
        /* .save::before { content: "‚úîÔ∏è"; } */
        .cancel::before { content: "‚úñÔ∏è"; }
        .addRowBtn::before { content: "‚ûï"; }
    </style>

</head>
<body>
    <h2 style="text-align:center;">Vehicle Records</h2>

    <div style="text-align:center; margin: 10px;">
        <button id="addRowBtn" class="addRowBtn">Add Vehicle</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>VIN</th>
                <th>License Plate</th>
                <th>Model</th>
                <th>Year</th>
                <th>Owner</th>
                <th>Contact</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="vehicleTable">
            {% for v in vehicles %}
            <tr data-id="{{ v.id }}">
                <td>{{ v.id }}</td>
                <td class="vin">{{ v.vin }}</td>
                <td class="license_plate">{{ v.license_plate }}</td>
                <td class="model">{{ v.model }}</td>
                <td class="year">{{ v.year }}</td>
                <td class="owner_name">{{ v.owner_name }}</td>
                <td class="owner_contact">{{ v.owner_contact }}</td>
                <td>
                    <button class="editBtn">Update</button>
                    <a href="{{ url_for('delete_vehicle', vehicle_id=v.id) }}" class="delete" onclick="return confirm('Are you sure?');">Delete</a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="8">No vehicles found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

<script>
document.addEventListener("DOMContentLoaded", () => {
    // ========== UPDATE ==========
    document.querySelectorAll(".editBtn").forEach(btn => {
        btn.addEventListener("click", function() {
            let row = this.closest("tr");
            let id = row.dataset.id;

            if (this.innerText === "Update") {
                ["vin","license_plate","model","year","owner_name","owner_contact"].forEach(cls => {
                    let td = row.querySelector("."+cls);
                    td.innerHTML = `<input type="text" value="${td.innerText}" />`;
                });
                this.innerText = "‚úî";
                this.classList.add("save");
            } else {
                let data = {
                    vin: row.querySelector(".vin input").value,
                    plate: row.querySelector(".license_plate input").value,
                    model: row.querySelector(".model input").value,
                    year: row.querySelector(".year input").value,
                    owner: row.querySelector(".owner_name input").value,
                    contact: row.querySelector(".owner_contact input").value
                };

                fetch(`/update/${id}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: new URLSearchParams(data)
                }).then(res => {
                    if(res.redirected) window.location.href = res.url;
                });
            }
        });
    });

    // ========== ADD ==========
    document.getElementById("addRowBtn").addEventListener("click", function() {
        let table = document.getElementById("vehicleTable");
        let newRow = document.createElement("tr");
        newRow.innerHTML = `
            <td>New</td>
            <td class="vin"><input type="text" placeholder="VIN"></td>
            <td class="license_plate"><input type="text" placeholder="Plate"></td>
            <td class="model"><input type="text" placeholder="Model"></td>
            <td class="year"><input type="number" placeholder="Year"></td>
            <td class="owner_name"><input type="text" placeholder="Owner"></td>
            <td class="owner_contact"><input type="text" placeholder="Contact"></td>
            <td>
                <button class="save addSave">‚úî</button>
                <button class="cancel">‚úñ</button>
            </td>
        `;
        table.prepend(newRow);

        // save new row
        newRow.querySelector(".addSave").addEventListener("click", () => {
            let data = {
                vin: newRow.querySelector(".vin input").value,
                plate: newRow.querySelector(".license_plate input").value,
                model: newRow.querySelector(".model input").value,
                year: newRow.querySelector(".year input").value,
                owner: newRow.querySelector(".owner_name input").value,
                contact: newRow.querySelector(".owner_contact input").value
            };

            fetch(`/add`, {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: new URLSearchParams(data)
            }).then(res => {
                if(res.redirected) window.location.href = res.url;
            });
        });

        // cancel add
        newRow.querySelector(".cancel").addEventListener("click", () => {
            newRow.remove();
        });
    });
});
</script>
</body>
</html>
